{% set vars = block.meta %}

<div class="BlockCards">
    <div class="BlockCards__Inner">
        <form action="{{ vars.baseUrl }}" class="BlockCards__Search">
            <div class="BlockCards__SearchInputWrapper">
                <input
                    type="text"
                    name="filter"
                    placeholder="Filter by keyword..."
                    class="input BlockCards__SearchInput"
                    value="{{ vars.currentFilter }}"
                >
            </div>
            <div class="BlockCards__SearchSubmitWrapper">
                <input
                    type="submit"
                    value="Filter"
                    class="button BlockCards__SearchSubmit"
                >
            </div>
        </form>
        <ul class="BlockCards__Cards">
            {% for orderItemModel in vars.items %}
                {# @var \modules\store\models\OrderItemModel orderItemModel #}
                {% set productModel = orderItemModel.getStoreProductModel() %}
                <li class="BlockCards__Card">
                    {% embed '_embeds/Card.twig' with {
                        inBlockGrid: true,
                    } %}
                        {% block headerPrimaryContent %}{{ productModel.title }}{% endblock %}
                        {% block headerSecondaryContent %}{{ orderItemModel.licenseKey }}{% endblock %}
                        {% block primaryContent %}
                            <div class="BlockCards__AuthorizedDomains">
                                <div class="BlockCards__AuthorizedDomainsTitle">Authorized Domains</div>
                                <ul class="BlockCards__AuthorizedDomainsList">
                                    {% for domainId,domain in orderItemModel.authorizedDomains %}
                                        <li class="BlockCards__AuthorizedDomainsListItem">
                                            <form method="post" accept-charset="UTF-8" class="JSFormClickSubmit">
                                                {{ csrfInput() }}
                                                <input type="hidden" name="action" value="store/license/remove-domain">
                                                <input type="hidden" name="redirect" value="{{ vars.redirectUrl }}">
                                                <input type="hidden" name="licenseId" value="{{ orderItemModel.id }}">
                                                <input type="hidden" name="domainId" value="{{ domainId }}">
                                                {{ domain|typeset }} <small>(<a href="#" class="JSFormClickSubmit__Trigger">remove</a>)</small>
                                            </form>
                                        </li>
                                    {% endfor %}
                                </ul>
                                <div class="BlockCards__AuthorizedDomainsAdd JSOverlayTriggerContainer">
                                    <a href="#" class="JSOverlayTriggerContainer__Trigger">Add Domain</a>
                                    <script type="text/template" class="JSOverlayTriggerContainer__Template">
                                        {% embed '_embeds/Overlay.twig' %}
                                            {% block overlayContent %}
                                                <form method="post" accept-charset="UTF-8" class="Overlay__Form">
                                                    {{ csrfInput() }}
                                                    <input type="hidden" name="action" value="store/license/add-domain">
                                                    <input type="hidden" name="licenseId" value="{{ orderItemModel.id }}">
                                                    <input type="hidden" name="redirect" value="{{ vars.redirectUrl }}">
                                                    <div class="Overlay__Title">Add Domain to {{ productModel.title|typeset }}</div>
                                                    <div class="Overlay__SubTitle">License Number:&nbsp;{{ orderItemModel.licenseKey }}</div>
                                                    <div class="Overlay__SubTitle2">(format: &ldquo;domain.com&rdquo;,&nbsp;do not include&nbsp;&ldquo;http:&#47;&#47;&rdquo;)</div>
                                                    <label class="label Overlay__FormLabel">
                                                        <input type="text" name="domain" class="input Overlay__FormInput" placeholder="domain.com">
                                                    </label>
                                                    <div class="Overlay__FormSubmitGroup">
                                                        <button class="button" type="submit">Submit</button>
                                                    </div>
                                                </form>
                                            {% endblock %}
                                        {% endembed %}
                                    </script>
                                </div>
                            </div>
                            <a href="{{ productModel.url }}" class="button button--colored button--outlined">
                                Product Page &raquo;
                            </a>
                        {% endblock %}
                        {% block secondaryContent %}
                            <div class="BlockCards__Notes">
                                <div class="BlockCards__NotesTitle">
                                    Notes <small><a href="#">edit</a></small>
                                </div>
                                <div class="BlockCards__NotesBody">
                                    {{ orderItemModel.notes|markdown|typeset }}
                                </div>
                            </div>
                        {% endblock %}
                        {% block footerPrimaryContent %}
                            {#<a href="#" class="button">Upgrade to V2 = $29.00</a>#}
                        {% endblock %}
                        {% block footerSecondaryContent %}
                            <a href="#" class="button button--colored button--outlined">
                                Download 1.4.4
                            </a>
                        {% endblock %}
                    {% endembed %}
                </li>
            {% endfor %}
        </ul>
        {% if vars.pagination %}
            <div class="PaginationWrapper">
                {% include '_partials/Pagination.twig' with {
                    pagination: vars.pagination
                } %}
            </div>
        {% endif %}
    </div>
</div>
